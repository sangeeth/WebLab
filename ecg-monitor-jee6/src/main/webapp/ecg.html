<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>ECG Waveform</title>
        <script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
        <script type="text/javascript" src="js/ecgmonitor.js"></script>

<script type="text/javascript">
var app = {
		   ecgMonitor : null, 		
		   url: null,
		   initialize: function() {
		      app.listen();
		   },
		   listen: function() {
		      $('#comet-frame').attr('src',  app.url);
		      console.log("Listening now at ", app.url);
		   },
		   start: function() {

			   $.ajax({
				   type: "POST",
				   url: "ecgfeed",
				   data: "action=start"
				 }).done(function( msg ) {
				   alert( "Response: " + msg );
				 });
		   },
		   stop: function() {
			   $.ajax({
				   type: "POST",
				   url: "ecgfeed",
				   data: "action=stop"
				 }).done(function( msg ) {
				   alert( "Response: " + msg );
				 });
		   },
		   update: function(data) {
			   console.log(data);
			   this.ecgMonitor.enque(data.list); 
		   }
};
		
$(window).load(function () {
	ecgMonitor = new ECGMonitor("#canvas");
	ecgMonitor.startup();
	
	app.ecgMonitor = ecgMonitor;
	app.url = '/ecg-monitor-jee6/ecgfeed';
	app.initialize();
});
</script>
</head>
<body style="background-color: black">
	<canvas id="canvas" width="600" height="230"></canvas>
	<iframe id="comet-frame" style="display: none"></iframe>
</body>
</html>